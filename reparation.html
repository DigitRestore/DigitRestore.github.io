<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigitRestore ‚Äì R√©paration</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">

    <style>
        :root {
            --accent-1: #ff4b5c;
            --accent-2: #ff2c47;
            --accent-3: #4fd2ff;
            --text-main: #f5f5f7;
            --text-soft: #c3c8df;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            min-height: 100vh;
            width: 100%;
            overflow-x: hidden;
            font-family: "Poppins", sans-serif;
            color: var(--text-main);
            background:
                radial-gradient(circle at 20% 10%, rgba(255,75,92,0.18) 0%, transparent 60%),
                radial-gradient(circle at 80% 90%, rgba(79,210,255,0.16) 0%, transparent 60%),
                #050814;
            background-size: cover;
            animation: bgMove 30s ease-in-out infinite alternate;
        }

        @keyframes bgMove {
            0%   { background-position: 0% 0%; }
            100% { background-position: 12% 16%; }
        }

        /* HEADER */
        header {
            width: 100%;
            padding: 20px 40px;
            display: flex;
            align-items: center;
            gap: 26px;
            opacity: 0;
            animation: fadeDown 0.9s ease forwards;
        }

        @keyframes fadeDown {
            from { opacity: 0; transform: translateY(-18px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .back-btn {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            background: rgba(255,75,92,0.22);
            border: 1px solid rgba(255,75,92,0.45);
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            transition: .25s;
            box-shadow: 0 0 14px rgba(255,75,92,0.35);
        }

        .back-btn span {
            font-size: 22px;
            color: white;
        }

        .back-btn:hover {
            transform: scale(1.12);
            box-shadow: 
                0 0 24px rgba(255,75,92,0.55),
                0 0 18px rgba(79,210,255,0.55);
            border-color: rgba(79,210,255,0.65);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .brand img { width: 68px; height: 68px; }

        .brand-text { display: flex; flex-direction: column; line-height: 1.18; }

        .digit {
            font-family: "Montserrat";
            font-size: 22px;
            font-weight: 800;
        }

        .restore {
            font-size: 22px;
            font-family: "Montserrat";
            font-weight: 900;
            background: linear-gradient(120deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tag {
            font-size: 10px;
            letter-spacing: .22em;
            color: var(--accent-3);
        }

        nav {
            display: flex;
            gap: 32px;
            margin-left: auto;
        }

        nav a {
            text-decoration: none;
            color: var(--text-main);
            font-size: 14px;
            opacity: .85;
            transition: .25s;
        }

        nav a:hover { opacity: 1; color: var(--accent-3); }

        /* CONTENT */
        .content {
            padding: 20px 40px;
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeUp 1s ease forwards;
            opacity: 0;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(30px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 40px;
            margin-bottom: 12px;
            font-weight: 600;
            text-shadow: 0 0 12px rgba(79,210,255,0.32);
        }

        .intro-text {
            font-size: 18px;
            color: var(--text-soft);
            margin-bottom: 35px;
            max-width: 850px;
            line-height: 1.6;
        }

        .selection-row {
            display: flex;
            gap: 26px;
            margin-top: 20px;
            width: 100%;
        }

        .selection-block {
            flex: 1;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        /* SELECTS */
        select {
            width: 100%;
            padding: 16px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.25);
            border-radius: 12px;
            color: var(--text-main);
            font-size: 16px;
            transition: .25s;

            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            position: relative;
            z-index: 3;
        }

        select option {
            background: #050814;
            color: var(--text-main);
        }

        select:focus {
            outline: none;
            border-color: var(--accent-3);
            background: rgba(79,210,255,0.12);
        }

        /* CONTINUE BUTTON */
        .continue-btn {
            margin-top: 40px;
            padding: 14px 26px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            color: white;
            background: linear-gradient(135deg, var(--accent-2), var(--accent-3));
            box-shadow: 0 0 20px rgba(79,210,255,0.4), 0 0 30px rgba(255,75,92,0.25);
            display: inline-block;
            transition: .25s;
            cursor: not-allowed;
            opacity: .45;
        }

        .continue-btn.enabled {
            cursor: pointer;
            opacity: 1;
        }

        #error-message {
            margin-top: 18px;
            font-size: 15px;
            color: var(--accent-1);
            font-weight: 500;
            display: none;
        }

        @media (max-width: 968px) {
            .selection-row {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>

<header>
    <a href="site.html" class="back-btn"><span>‚üµ</span></a>

    <div class="brand">
        <img src="logo.png" alt="logo">
        <div class="brand-text">
            <span class="digit">DIGIT <span class="restore">RESTORE</span></span>
            <span class="tag">R√âPARATION & RECONDITIONNEMENT</span>
            <span class="tag">SMARTPHONES & TABLETTES</span>
        </div>
    </div>

    <nav>
        <a href="reparation.html">R√©paration</a>
        <a href="#">Reprise / Achat</a>
        <a href="#">Reconditionnement</a>
        <a href="#">T√©l√©phones & Accessoires</a>
        <a href="#">Qualit√©</a>
        <a href="#">Conditions g√©n√©rales</a>
        <a href="#">Contact</a>
    </nav>
</header>

<div class="content">

    <h1>R√©paration de votre appareil</h1>
    <p class="intro-text">
        S√©lectionnez votre appareil pour obtenir une estimation de r√©paration personnalis√©e.
    </p>

    <div class="selection-row">

        <div class="selection-block">
            <div class="section-title">Type d'appareil</div>
            <select id="typeSelect">
                <option value="">S√©lectionnez‚Ä¶</option>
            </select>
        </div>

        <div class="selection-block">
            <div class="section-title">Marque</div>
            <select id="brandSelect">
                <option value="">S√©lectionnez un type d'appareil‚Ä¶</option>
            </select>
        </div>

        <div class="selection-block">
            <div class="section-title">Mod√®le</div>
            <select id="modelSelect">
                <option value="">S√©lectionnez une marque‚Ä¶</option>
            </select>
        </div>

    </div>

    <a id="continueBtn" class="continue-btn">Continuer</a>
    <div id="error-message">Veuillez remplir les trois champs pour continuer.</div>

</div>


<!-- SCRIPT JSON -->
<script>
document.addEventListener("DOMContentLoaded", async () => {

    const typeSelect   = document.getElementById("typeSelect");
    const brandSelect  = document.getElementById("brandSelect");
    const modelSelect  = document.getElementById("modelSelect");
    const continueBtn  = document.getElementById("continueBtn");
    const errorMsg     = document.getElementById("error-message");

    // Contient le contenu de donnees/types-et-marques.json
    let typesData = {};

    // Contient le contenu du fichier JSON pour la combinaison type + marque s√©lectionn√©e
    let currentBrandData = null;

    /* üîπ Utils : normaliser une marque pour le nom du fichier (apple ‚Üí apple, "Honor " ‚Üí honor) */
    function slugifyBrand(brand) {
        return brand
            .toLowerCase()
            .trim()
            .replace(/\s+/g, "-")       // espaces ‚Üí tirets (au cas o√π tu changes le naming plus tard)
            .replace(/[^a-z0-9\-]/g, ""); // on garde lettre/chiffre/tiret
    }

    /* üîπ Charger la liste des types et marques */
    try {
        const response = await fetch("donnees/types-et-marques.json", { cache: "no-cache" });
        if (!response.ok) {
            throw new Error("HTTP " + response.status);
        }
        typesData = await response.json();
    } catch (e) {
        console.error("Erreur lors du chargement de donnees/types-et-marques.json :", e);
        errorMsg.textContent = "Une erreur est survenue lors du chargement des donn√©es. Merci de r√©essayer plus tard.";
        errorMsg.style.display = "block";
        return;
    }

    /* üîπ Remplir le select des types √† partir des cl√©s du JSON */
    Object.keys(typesData).forEach(typeKey => {
        const opt = document.createElement("option");
        opt.value = typeKey; // ex: "smartphones", "tablettes"
        // On met une jolie majuscule
        opt.textContent = typeKey.charAt(0).toUpperCase() + typeKey.slice(1);
        typeSelect.appendChild(opt);
    });

    /* üîπ Quand on change de type */
    typeSelect.addEventListener("change", () => {
        // Reset des listes d√©pendantes
        brandSelect.innerHTML = '<option value="">S√©lectionnez une marque‚Ä¶</option>';
        modelSelect.innerHTML = '<option value="">S√©lectionnez une marque‚Ä¶</option>';
        currentBrandData = null;
        errorMsg.style.display = "none";
        updateButtonState();

        const selectedType = typeSelect.value;
        if (!selectedType) {
            return;
        }

        // R√©cup√©rer les marques pour ce type
        const brandsForType = typesData[selectedType];

        if (Array.isArray(brandsForType)) {
            // Cas normal : tableau de marques
            brandsForType.forEach(brand => {
                const opt = document.createElement("option");
                opt.value = brand;
                opt.textContent = brand;
                brandSelect.appendChild(opt);
            });
        } else if (brandsForType && typeof brandsForType === "object") {
            // Au cas o√π tu pr√©f√®res un jour passer √† un objet { "Apple": {...}, "Samsung": {...} }
            Object.keys(brandsForType).forEach(brand => {
                const opt = document.createElement("option");
                opt.value = brand;
                opt.textContent = brand;
                brandSelect.appendChild(opt);
            });
        }
    });

    /* üîπ Quand on change de marque */
    brandSelect.addEventListener("change", async () => {
        modelSelect.innerHTML = '<option value="">S√©lectionnez un mod√®le‚Ä¶</option>';
        errorMsg.style.display = "none";
        currentBrandData = null;
        updateButtonState();

        const selectedType  = typeSelect.value;
        const selectedBrand = brandSelect.value;

        if (!selectedType || !selectedBrand) {
            return;
        }

        const brandSlug = slugifyBrand(selectedBrand);
        const jsonPath  = `donnees/${selectedType}-${brandSlug}.json`;

        try {
            const response = await fetch(jsonPath, { cache: "no-cache" });
            if (!response.ok) {
                throw new Error("HTTP " + response.status);
            }
            currentBrandData = await response.json();
        } catch (e) {
            console.error("Erreur lors du chargement du fichier de mod√®les :", e);
            errorMsg.textContent = "Aucun mod√®le disponible pour cette combinaison type / marque pour le moment.";
            errorMsg.style.display = "block";
            return;
        }

        // On remplit la liste des mod√®les
        if (!currentBrandData || !currentBrandData.models) {
            errorMsg.textContent = "Aucun mod√®le disponible pour cette combinaison.";
            errorMsg.style.display = "block";
            return;
        }

        // Si models est un tableau : ["iPhone 12", "iPhone 13", ...]
        if (Array.isArray(currentBrandData.models)) {
            currentBrandData.models.forEach(model => {
                const opt = document.createElement("option");
                opt.value = model;
                opt.textContent = model;
                modelSelect.appendChild(opt);
            });
        }
        // Si models est un objet : { "iPhone 12": [...repairs], "iPhone 13": [...] }
        else if (typeof currentBrandData.models === "object") {
            Object.keys(currentBrandData.models).forEach(modelName => {
                const opt = document.createElement("option");
                opt.value = modelName;
                opt.textContent = modelName;
                modelSelect.appendChild(opt);
            });
        }

        updateButtonState();
    });

    /* üîπ Quand on choisit un mod√®le */
    modelSelect.addEventListener("change", () => {
        errorMsg.style.display = "none";
        updateButtonState();
    });

    /* üîπ Gestion du bouton "Continuer" */
    function updateButtonState() {
        if (typeSelect.value && brandSelect.value && modelSelect.value) {
            continueBtn.classList.add("enabled");
            continueBtn.style.cursor = "pointer";
        } else {
            continueBtn.classList.remove("enabled");
            continueBtn.style.cursor = "not-allowed";
        }
    }

    /* üîπ Clic sur "Continuer" */
    continueBtn.addEventListener("click", () => {
        if (!continueBtn.classList.contains("enabled")) {
            errorMsg.textContent = "Veuillez remplir les trois champs pour continuer.";
            errorMsg.style.display = "block";
            return;
        }

        const type  = typeSelect.value;   // ex: "smartphones"
        const brand = brandSelect.value;  // ex: "Apple"
        const model = modelSelect.value;  // ex: "iPhone 12"

        // Redirection identique √† ton fonctionnement actuel
        window.location.href =
            `reparation-pannes.html?type=${encodeURIComponent(type)}&marque=${encodeURIComponent(brand)}&modele=${encodeURIComponent(model)}`;
    });

});
</script>

</body>
</html>
